{% extends 'layout.html' %}
{% load my_filters %}

{% block title %}
    <title>
        分析报告
    </title>
{% endblock %}

{% block content %}
    <!-- 将后端传来的字典转化为json -->
    {{ Get_keywords_report|json_script:"Get_keywords_report_json" }}
    {{ Text_predict_report|json_script:"Text_predict_report_json" }}

    <div class="jumbotron container">
        <p style="margin-left: 100px">您输入的内容为诈骗的概率为</p>
        <div class="flex-container" style="margin-left: 250px">
            <h1 style="color: red">{{ Text_predict_report.probability.1 }}</h1>
            <button class="btn" id="border-btn" style="font-weight: bold;margin-left: 25%;font-size:25px ">
                <span class="glyphicon glyphicon-arrow-right" aria-hidden="true" style="margin-right: 10px"></span>
                查 看 详 情
            </button>
        </div>
    </div>

    <!-- 第一层两个图表：柱状图、饼图 -->
    <div id="analysis-bar-pie">
        <div class="container">
            <div class="col-md-6">
                <div class="panel panel-default">
                    <div class="panel-body">
                        <!-- 形成图表 -->
                        <div id="myChart01" style="width: 100%;height:400px;"></div>
                    </div>
                </div>
            </div>
            <div class="col-md-6">
                <div class="panel panel-default">
                    <div class="panel-body">
                        <!-- 在这里放置第二个图表 -->
                        <div id="pieChart01" style="width: 100%;height:400px;"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 第二层三个标签页设置，表明推算原因 -->
    <div id="analysis-detail" class="panel panel-default container index_panel">
        <div class="panel-body center-block">
            <div id="tab_chart">

                <!-- Nav tabs -->
                <ul class="nav nav-tabs" role="tablist">
                    <li role="presentation" class="active"><a href="#home" aria-controls="home" role="tab"
                                                              data-toggle="tab">Home</a>
                    </li>
                    <li role="presentation"><a href="#profile" aria-controls="profile" role="tab" data-toggle="tab">Profile</a>
                    </li>
                    <li role="presentation"><a href="#messages" aria-controls="messages" role="tab"
                                               data-toggle="tab">Messages</a></li>
                    <li role="presentation"><a href="#settings" aria-controls="settings" role="tab"
                                               data-toggle="tab">Settings</a></li>
                </ul>

                <!-- Tab panes -->
                <div class="tab-content">
                    <div role="tabpanel" class="tab-pane active" id="home">...</div>
                    <div role="tabpanel" class="tab-pane" id="profile">...</div>
                    <div role="tabpanel" class="tab-pane" id="messages">...</div>
                    <div role="tabpanel" class="tab-pane" id="settings">...</div>
                </div>

            </div>
        </div>
    </div>


{% endblock %}


{% block js %}
    <script type="text/javascript">
        // 将后端传来的json转化为数组
        function Get_bar_series_data(element_name, my_key) {
            var my_json = JSON.parse(document.getElementById(element_name).textContent);
            console.log(my_json);
            return my_json[my_key];
        }

        // 基于准备好的dom，初始化echarts实例
        var myChart01 = echarts.init(document.getElementById('myChart01'));

        // 指定图表的配置项和数据
        var option01 = {
            title: {
                text: '关键词提取'
            },
            tooltip: {},
            legend: {
                data: ['词数', '词频']
            },
            xAxis: {
                data: Get_bar_series_data('Get_keywords_report_json', 'Keywords')
            },
            yAxis: {},
            series: [{
                name: '词数',
                type: 'bar',
                data: Get_bar_series_data('Get_keywords_report_json', 'Keywords_Num')

            }, {
                name: '词频',
                type: 'bar',
                data: Get_bar_series_data('Get_keywords_report_json', 'Keywords_Frequency')
            }]
        };

        function Get_pie_series_data(element_name) {
            var my_json = JSON.parse(document.getElementById(element_name).textContent);
            console.log(my_json);
            var data = [];
            data.push({name: '非诈骗', value: my_json['probability'][0]});
            data.push({name: '诈骗', value: my_json['probability'][1]});
            return data;
        }

        // 基于准备好的dom，初始化echarts实例
        var myChart02 = echarts.init(document.getElementById('pieChart01'));


        // 指定图表的配置项和数据
        option02 = {
            title: {
                text: '诈骗概率',
                subtext: '',
                left: 'center'
            },
            tooltip: {
                trigger: 'item'
            },
            legend: {
                orient: 'vertical',
                left: 'left'
            },
            series: [
                {
                    name: 'Access From',
                    type: 'pie',
                    radius: '50%',
                    data: Get_pie_series_data('Text_predict_report_json'),
                    emphasis: {
                        itemStyle: {
                            shadowBlur: 10,
                            shadowOffsetX: 0,
                            shadowColor: 'rgba(0, 0, 0, 0.5)'
                        }
                    }
                }
            ]
        };


        document.getElementById('border-btn').addEventListener('click', function () {
            document.getElementById('analysis-bar-pie').style.display = 'block';
            document.getElementById('analysis-detail').style.display = 'block';

            myChart01.resize();
            myChart02.resize();

            // 使用刚指定的配置项和数据显示图表。
            myChart01.setOption(option01);
            // 使用刚指定的配置项和数据显示图表。
            myChart02.setOption(option02);
        });


    </script>
{% endblock %}